<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Price Category Prediction</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <style>
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            min-height: 100vh;
            color: #fff;
            padding: 20px 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .form-container {
            background-color: rgba(0, 0, 0, 0.85);
            padding: 30px;
            border-radius: 15px;
            max-width: 750px;
            margin: 60px auto;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 25px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.7);
            font-size: 2rem;
        }

        .form-group label {
            color: #fff;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .form-row {
            margin-bottom: 15px;
        }

        .input-hint {
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 5px;
        }

        .input-error {
            font-size: 0.85rem;
            color: #ff6b6b;
            margin-top: 5px;
            display: none;
        }

        #result {
            margin-top: 25px;
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            padding: 20px;
            border-radius: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-predict {
            background: linear-gradient(to right, #00c853, #00e676);
            border: none;
            font-weight: bold;
            padding: 15px;
            font-size: 1.2rem;
            transition: all 0.3s;
            border-radius: 8px;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .btn-predict:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 255, 136, 0.5);
        }

        .btn-predict:active {
            transform: translateY(1px);
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #00ff88;
            box-shadow: 0 0 0 0.3rem rgba(0, 255, 136, 0.25);
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .header-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            display: block;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .is-invalid {
            border-color: #ff6b6b !important;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25) !important;
        }
        
        .validation-summary {
            background-color: rgba(255, 107, 107, 0.2);
            border-left: 4px solid #ff6b6b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
        }
        
        .valid-field {
            border-color: #00ff88 !important;
        }
        
        .success-result {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.7);
        }
        
        .error-result {
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.7);
        }
        
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* FIXED DROPDOWN STYLES - SIMPLIFIED */
        input.form-control,
        select.form-control {
            height: 48px;          /* same height */
            line-height: 1.5;      /* consistent line spacing */
            padding: 12px 15px;    /* same padding */
            border-radius: 8px;    /* uniform rounded corners */
            display: block;        /* ensure block-level consistency */
        }

        /* Placeholder / option text styling */
        select.form-control option[value=""] {
            color: rgba(255, 255, 255, 0.5);  /* faded placeholder style */
        }
        
        /* Remove all z-index and positioning that was causing issues */
        .form-group, .form-row, select.form-control {
            position: static;
            z-index: auto;
        }
        
        /* Ensure dropdown options are visible */
        select.form-control option {
            background-color: #333;
            color: white;
            padding: 10px;
        }
        
        /* Remove any overflow restrictions */
        select, .form-control, .form-group {
            overflow: visible !important;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="form-container">
        <span class="header-icon">üè†</span>
        <h2>Price Category Prediction</h2>
        
        <div class="validation-summary" id="validationSummary">
            <strong>Please fix the following errors:</strong>
            <ul id="errorList"></ul>
        </div>
        
        <form id="predictionForm">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="bedrooms">Bedrooms</label>
                    <input type="number" id="bedrooms" name="bedrooms" class="form-control" placeholder="Enter 1-6" min="1" max="6" required>
                    <div class="input-hint">Enter a value between 1 and 6</div>
                    <div class="input-error" id="bedrooms-error">Please enter a value between 1 and 6</div>
                </div>
                <div class="form-group col-md-6">
                    <label for="bathrooms">Bathrooms</label>
                    <input type="number" id="bathrooms" name="bathrooms" class="form-control" placeholder="Enter 1-4" min="1" max="4" required>
                    <div class="input-hint">Enter a value between 1 and 4</div>
                    <div class="input-error" id="bathrooms-error">Please enter a value between 1 and 4</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="square_feet">Square Feet</label>
                    <input type="number" id="square_feet" name="square_feet" class="form-control" placeholder="Enter 600-4000" min="600" max="4000" required>
                    <div class="input-hint">Enter a value between 600 and 4000</div>
                    <div class="input-error" id="square_feet-error">Please enter a value between 600 and 4000</div>
                </div>
                <div class="form-group col-md-6">
                    <label for="location">Location</label>
                    <select id="location" name="location" class="form-control" required>
                        <option value="">Select a location</option>
                        <option>Manhattan</option>
                        <option>Brooklyn</option>
                        <option>Bronx</option>
                        <option>Queens</option>
                        <option>Staten Island</option>
                        <option>Harlem</option>
                    </select>
                    <div class="input-error" id="location-error">Please select a location</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="year_built">Year Built</label>
                    <input type="number" id="year_built" name="year_built" class="form-control" placeholder="Enter 1980-2024" min="1980" max="2024" required>
                    <div class="input-hint">Enter a year between 1980 and current year</div>
                    <div class="input-error" id="year_built-error">Please enter a valid year (up to current year)</div>
                </div>
                <div class="form-group col-md-6">
                    <label for="garage">Garage</label>
                    <select id="garage" name="garage" class="form-control" required>
                        <option value="">Select an option</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                    <div class="input-error" id="garage-error">Please select an option</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="has_pool">Has Pool</label>
                    <select id="has_pool" name="has_pool" class="form-control" required>
                        <option value="">Select an option</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                    <div class="input-error" id="has_pool-error">Please select an option</div>
                </div>
                <div class="form-group col-md-6">
                    <label for="property_type">Property Type</label>
                    <select id="property_type" name="property_type" class="form-control" required>
                        <option value="">Select a property type</option>
                        <option>Apartment</option>
                        <option>Condo</option>
                        <option>House</option>
                    </select>
                    <div class="input-error" id="property_type-error">Please select a property type</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="num_floors">Number of Floors</label>
                    <input type="number" id="num_floors" name="num_floors" class="form-control" placeholder="Enter 1-3" min="1" max="4" required>
                    <div class="input-hint">Enter a value between 1 and 3</div>
                    <div class="input-error" id="num_floors-error">Please enter a value between 1 and 3</div>
                </div>
                <div class="form-group col-md-6">
                    <label for="has_basement">Has Basement</label>
                    <select id="has_basement" name="has_basement" class="form-control" required>
                        <option value="">Select an option</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                    <div class="input-error" id="has_basement-error">Please select an option</div>
                </div>
            </div>

            <button type="submit" class="btn btn-predict btn-block">Predict Price Category</button>
        </form>

        <div id="result"></div>
    </div>
</div>

<script>
    console.log("‚úÖ Script loaded");

    const priceRanges = {
        "Low": "329,258 to 766,919",
        "Medium": "766,919 to 940,869",
        "High": "940,869 to 1,402,499"
    };

    function validateForm() {
        let valid = true;
        let errorList = document.getElementById("errorList");
        errorList.innerHTML = "";

        const fields = [
            { id: "bedrooms", min: 1, max: 6 },
            { id: "bathrooms", min: 1, max: 4 },
            { id: "square_feet", min: 600, max: 4000 },
            { id: "year_built", min: 1980, max: new Date().getFullYear() },
            { id: "num_floors", min: 1, max: 3 }
        ];

        fields.forEach(field => {
            const el = document.getElementById(field.id);
            const val = Number(el.value);
            if (isNaN(val) || val < field.min || val > field.max) {
                valid = false;
                el.classList.add("is-invalid");
                const errorItem = document.createElement("li");
                errorItem.textContent = `${el.previousElementSibling.innerText} must be between ${field.min} and ${field.max}`;
                errorList.appendChild(errorItem);
            } else {
                el.classList.remove("is-invalid");
                el.classList.add("valid-field");
            }
        });

        const selects = ["location", "garage", "has_pool", "property_type", "has_basement"];
        selects.forEach(id => {
            const el = document.getElementById(id);
            if (!el.value) {
                valid = false;
                el.classList.add("is-invalid");
                const errorItem = document.createElement("li");
                errorItem.textContent = `Please select a value for ${el.previousElementSibling.innerText}`;
                errorList.appendChild(errorItem);
            } else {
                el.classList.remove("is-invalid");
                el.classList.add("valid-field");
            }
        });

        document.getElementById("validationSummary").style.display = valid ? "none" : "block";
        return valid;
    }

    document.getElementById("predictionForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        console.log("üìå Form submitted");

        document.getElementById("result").style.display = "none";

        if (!validateForm()) {
            console.log("‚ùå Validation failed");
            document.getElementById("result").innerText = "‚ùå Please fix the validation errors above";
            document.getElementById("result").className = "error-result";
            document.getElementById("result").style.display = "block";
            return;
        }

        const formData = new FormData(e.target);
        const data = {};
        formData.forEach((value, key) => {
            if (key === "location" || key === "property_type") {
                data[key] = value;
            } else {
                data[key] = Number(value);
            }
        });

        console.log("üì§ Sending data to backend:", data);

        try {
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '‚è≥ Predicting...';
            submitBtn.disabled = true;

            const response = await fetch("/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            console.log("üì¶ Parsed result:", result);

            if (response.ok && result.predicted_category) {
                let category = result.predicted_category;
                let range = priceRanges[category] || "Unknown";
                document.getElementById("result").innerHTML = `
                    üè∑Ô∏è Predicted Category: <strong>${category}</strong><br>
                    üí≤ Price Range: <strong>${range}</strong>
                `;
                document.getElementById("result").className = "success-result";
            } else {
                document.getElementById("result").innerText = "‚ùå Error: " + (result.error || "Unknown error");
                document.getElementById("result").className = "error-result";
            }

            document.getElementById("result").style.display = "block";
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;

        } catch (error) {
            console.error("‚ùå Fetch error:", error);
            document.getElementById("result").innerText = "‚ùå Network error: " + error.message;
            document.getElementById("result").className = "error-result";
            document.getElementById("result").style.display = "block";
            e.target.querySelector('button[type="submit"]').innerHTML = 'Predict Price Category';
            e.target.querySelector('button[type="submit"]').disabled = false;
        }
    });
</script>
</body>
</html>